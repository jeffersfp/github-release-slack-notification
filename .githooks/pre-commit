#!/bin/sh

# Pre-commit hook to ensure dist/ is built and up to date

echo "ğŸ” Checking if distribution needs to be rebuilt..."

# Only run if src/ or package.json changed
if git diff --cached --name-only | grep -qE '^(src/|package\.json)'; then
  echo "ğŸ“¦ Changes detected in src/ or package.json"
  echo "ğŸ—ï¸  Building distribution..."
  
  npm run build --silent
  
  # Check if dist/ changed after build
  if ! git diff --exit-code --quiet dist/; then
    echo ""
    echo "âš ï¸  Distribution was out of sync!"
    echo ""
    echo "âœ… I've rebuilt it for you. Files updated:"
    git diff --name-only dist/
    echo ""
    echo "ğŸ“ Adding dist/ to this commit..."
    git add dist/
    echo "âœ… Done! Proceeding with commit."
  else
    echo "âœ… Distribution is up to date"
  fi
else
  echo "âœ… No source changes detected, skipping build"
fi

echo ""
